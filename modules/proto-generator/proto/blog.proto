syntax = "proto3";

package blog;

service BlogPublicService {
  rpc Register(CreateUserRequest) returns (AuthResponse);
  rpc Login(AuthRequest) returns (AuthResponse);
  rpc GetPost(GetPostRequest) returns (PostResponse);
  rpc ListPosts(ListPostsRequest) returns (ListPostResponse);
  rpc StreamPosts(StreamPostsRequest) returns (stream PostResponse);
}
service BlogProtectedService {
  rpc CreatePost(CreatePostRequest) returns (PostResponse);
  rpc UpdatePost(UpdatePostRequest) returns (PostResponse);
  rpc DeletePost(DeletePostRequest) returns (EmptyResponse);
}

// Auth
message CreateUserRequest {
  string username = 1;
  string email = 2;
  string password = 3;
}
message AuthenticatedUser {
  string email = 1;
  int64 user_id = 2;
  string username = 3;
}
message AuthRequest {
  string email = 1;
  string password = 2;
}
message AuthResponse {
  string token = 1;
  AuthenticatedUser user = 2;
}

// Post
message PostResponse {
  int64 id = 1;
  string title = 2;
  string content = 3;
  int64 author_id = 4;
  int64 created_at = 5;
  int64 updated_at = 6;
}
message CreatePostRequest {
  string title = 1;
  string content = 2;
}
message GetPostRequest {
  int64 id = 1;
}
message ListPostsRequest {
  int64 limit = 1;
  int64 offset = 2;
}
message ListPostResponse {
  repeated PostResponse posts = 1;
  int64 total = 2;
  int64 limit = 3;
  int64 offset = 4;
}
message StreamPostsRequest {
  int64 limit = 1;
  int64 offset = 2;
}
message UpdatePostRequest {
  int64 id = 1;
  string title = 2;
  string content = 3;
}
message DeletePostRequest {
  int64 id = 1;
}
message EmptyResponse{
}